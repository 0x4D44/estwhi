# Estimation Whist – Remaining Parity Tasks (Sep 29, 2025)

## 1. Complete 71×96 Card Asset Set
- **Goal**: Ensure every card ID 1..52 uses a consistent bitmap so suits/ranks render identically in both the hand and trick rows.
- **Work items**:
  - Extend "tools/extract-res" to emit the remaining `card_71x96_0XX.bmp` assets from `ESTWHI.RES`. If those resources are absent, batch-process the modern "cards2" deck to enforce opaque white backgrounds (e.g., convert to 24-bit DIBs and normalize the palette).
  - Update `resources/cards.rcinc` so all 52 IDs reference the finalized set and remove mixed `cards_from_exe` / `cards2` references.
  - Regenerate assets and commit them (or check in the preprocessing script if we transform the modern deck at build time).
  - Play through multiple rounds in both classic and modern layouts to verify card rendering, especially in the trick row where color issues were observed.

## 2. Cheat & Probability Windows
- **Goal**: Re-enable the optional helper windows (“Cheat Cards” and “Probability”) that exist in the Turbo Pascal version.
- **Work items**:
  - Port the window logic: create dedicated structs for the cheat/probability windows, register their window classes, and replicate drawing routines (probability grid, cheat information) using Win32 GDI.
  - Hook Options dialog toggles so enabling/disabling the windows creates/destroys the HWNDs, and persist their geometry to the registry (matching the legacy INI behavior).
  - Update status messaging and redraw triggers so the auxiliary windows refresh whenever hands, calls, or probabilities change.
  - Manual QA: open/close dialogs, drag/resize windows, confirm positions persist across relaunches, and verify cheat info stays in sync with gameplay.

## 3. Random Things & Icon Twirl Timers
- **Goal**: Restore the “Random Things” animations and icon twirl timers provided by the legacy app.
- **Work items**:
  - Recreate the timer handlers (`ID_RNDTIMER`, `ID_ICNTIMER`) in Rust, translating Pascal’s logic (random effects cadence, icon animation) into Win32 timer events.
  - Fully implement the Random Things dialog: map controls to state, persist settings, and ensure toggling options starts/stops timers as the original does.
  - Verify timers pause/resume appropriately during gameplay (e.g., disabled while hands are in progress if that was the original behavior) and that icon twirl obeys the configured interval.
  - Document any deviations if we decide to retire or simplify the feature.

## 4. Asset Pipeline Safety Check
- **Goal**: Prevent missing or malformed resource files from reaching runtime builds.
- **Work items**:
  - Add a build-time validation step (in `build.rs` or a separate tool) that confirms every bitmap path referenced in `resources/cards.rcinc` exists and reports clear errors if not.
  - Optionally extend the check to inspect image properties (bit depth, presence of alpha channel, white background) and fail fast if assets drift from expected parameters.
  - Integrate the validation into CI (GitHub Actions) and document the workflow in `README.md` so developers can run it locally after updating assets.
  - Provide troubleshooting guidance for common RC failures (missing SDK tools, resource path issues) and the commands/scripts to regenerate the card set.

## Quality & Testing Considerations
- After each task, run full gameplay smoke tests: bidding, trick pauses (Dialog & Mouse), scoring, and options persistence.
- Capture comparison screenshots once assets/windows are ported to confirm layout parity with the Turbo Pascal version.
- Update the project documentation to reflect any new scripts, feature flags, or platform requirements introduced while closing these gaps.
