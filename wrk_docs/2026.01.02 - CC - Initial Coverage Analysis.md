# Code Coverage Report
**Date:** 2026.01.02
**Project:** Estimation Whist (estwhi)

## Executive Summary
The project is divided into a core logic library (`estwhi-core`) and a Windows GUI application (`estwhi`).
*   **Logic Coverage:** High (~95%). The core game rules (scoring, trick resolution, shuffling) are well-tested in `estwhi-core`.
*   **UI/App Coverage:** Zero (0%). The main application entry point (`main.rs`) and persistence layer (`registry.rs`) have no unit tests.
*   **Overall Estimated Coverage:** ~15-20% (by lines of code, since `main.rs` is massive).

## Detailed Analysis

### 1. `estwhi-core` (Game Logic)
*   **Status:** **Healthy**.
*   **Coverage:** High.
*   **Tests:** 9 unit tests covering scoring modes, card conversion, and trick resolution.
*   **Gaps:**
    *   Edge cases in scoring (e.g., max players, max cards).
    *   Deck shuffling randomness properties (smoke test only).
    *   `GameConfig` validation logic is missing (e.g., ensuring 2-6 players).

### 2. `estwhi` (Windows GUI)
*   **Status:** **Critical**.
*   **Coverage:** 0%.
*   **Analysis:**
    *   `main.rs` (>4,000 lines): Contains all UI logic, event handling, AI logic, and game state management. No tests exist.
    *   `registry.rs`: Handles Registry I/O. No tests exist.
*   **Risks:**
    *   Regressions in game state transitions (e.g., round advancement).
    *   Registry parsing errors could crash the app or load invalid configs.
    *   AI logic is embedded in UI code, making it untestable.

## Recommendations
To achieve the target of >98% testable coverage:
1.  **Refactor `main.rs`:** Extract pure logic (AI, State Machines) into testable modules.
2.  **Test Registry:** implement integration tests for `registry.rs` using a test-specific registry key.
3.  **Expand Core Tests:** Cover all `estwhi-core` edge cases to hit 100% there.
