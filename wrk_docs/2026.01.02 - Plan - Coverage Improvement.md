# Coverage Improvement Plan
**Goal:** Increase testable code coverage to >98%.

## Strategy
Since we cannot easily unit test the Win32 API calls (rendering, window creation) without a UI automation framework, we will redefine "Coverage" for this context as:
> **100% of Business Logic, Game State Management, and Persistence Logic must be tested.**

We will achieve this by extracting logic from the monolithic `main.rs` into testable units.

## Stages

### Stage 1: Core Hardening & Registry Tests
*   **Objective:** 100% coverage on `estwhi-core` and `registry.rs`.
*   **Tasks:**
    1.  Add missing edge-case tests to `estwhi-core` (max players, invalid inputs).
    2.  Create a test suite for `estwhi/src/registry.rs` using a temporary registry subkey (integration style).

### Stage 2: Extract & Test AI Logic
*   **Objective:** Move AI logic out of `main.rs` and test it.
*   **Tasks:**
    1.  Identify the "Simple AI" logic in `main.rs`.
    2.  Refactor it into `estwhi-core` (or a new `ai` module).
    3.  Write unit tests validating AI decisions (e.g., "AI follows suit", "AI plays high to win").

### Stage 3: Extract & Test Game State
*   **Objective:** Move `GameState` and state transitions out of `main.rs`.
*   **Tasks:**
    1.  Extract `GameState` struct and its mutation methods (e.g., `advance_round`, `record_trick`) into a dedicated module.
    2.  Write tests for state transitions (e.g., "Round 1 -> Round 2", "Game Over" condition).

### Stage 4: Configuration Logic
*   **Objective:** Test `UiConfig` and `GameConfig` validation.
*   **Tasks:**
    1.  Ensure invalid config values (e.g., 100 players) are clamped/rejected.
    2.  Write tests for this validation logic.

## Execution
I will start with Stage 1 immediately.
